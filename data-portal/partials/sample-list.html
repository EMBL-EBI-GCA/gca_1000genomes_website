<div es-search="ListCtrl.searchBody" hits-as="samples" es-type="sample" is-loading-as="esSamplesLoading">
  <h1>Samples</h1>
  <h4 class="text-center element-loading" ng-if="ListCtrl.dataCollections.isLoading || ListCtrl.analysisGroups.isLoading || esPopulationsLoading"><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> Loading...</h4>
  <div ng-if="apiError || ListCtrl.dataCollections.error || ListCtrlanalysisGroups.error">
     <div class="col-md-10 col-sm-10 col-md-offset-1 col-sm-offset-1"><div class="alert alert-warning alert-dismissible text-center" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
           <h3 ng-if="apiError">{{apiError.status}}: {{apiError.statusText}}</h3>
           <h3 ng-if="ListCtrl.dataCollections.error">{{ListCtrl.dataCollections.error.status}}: {{ListCtrl.dataCollections.error.statusText}}</h3>
           <h3 ng-if="ListCtrl.analysisGroups.error">{{ListCtrl.analysisGroups.error.status}}: {{ListCtrl.analysisGroups.error.statusText}}</h3>
    </div></div>
  </div>

  <div ng-show="samples">

  <div class="form form-inline form-margins">
  <button type="button" class="btn btn-default" ng-click="ListCtrl.togglePopPanel()">Filter by population <span class="caret"></span></button>
  <button type="button" class="btn btn-default" ng-click="ListCtrl.toggleAGPanel()">Filter by analysis group <span class="caret"></span></button>
  <button type="button" class="btn btn-default" ng-click="ListCtrl.toggleDCPanel()">Filter by data collection <span class="caret"></span></button>
  <button type="button" class="btn btn-default" ng-click="ListCtrl.toggleView()">Toggle table view</button>
  <button type="button" class="btn btn-default" ng-click="ListCtrl.sampleExport()">Download the list</button>
  </div>

  <div class="col-md-8 col-md-offset-2">
  </div>

  <div class="col-md-8 col-md-offset-2">

  <div class="panel panel-default" ng-if="ListCtrl.showPopPanel">
  <div class="panel-heading">Filter by population
  <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="ListCtrl.togglePopPanel()"><span aria-hidden="true">&times;</span></button>
  </div>
  <div class="panel-body">
    <h4 class="text-center element-loading" ng-if="ListCtrl.populations.isLoading"><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> Loading...</h4>
    <div class="form form-inline">
      <div class="checkbox checkbox-population" ng-repeat="population in ListCtrl.populations.hits.hits" uib-popover="{{population.fields.name[0]}}" popover-trigger="mouseenter">
        <label><input type="checkbox" ng-model="ListCtrl.filteredPops[population.fields.code[0]]" ng-change="ListCtrl.search({page: 1})"></input>{{population.fields.code[0]}}</label>
      </div>
    </div>
  </div></div>

  <div class="panel panel-default" ng-if="ListCtrl.showAGPanel">
  <div class="panel-heading">Filter by analysis group
  <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="ListCtrl.toggleAGPanel()"><span aria-hidden="true">&times;</span></button>
  </div>
  <div class="panel-body">
    <h4 class="text-center element-loading" ng-if="ListCtrl.analysisGroups.isLoading"><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> Loading...</h4>
    <div ng-if="ListCtrl.analysisGroups.error">
       <div class="col-md-10 col-sm-10 col-md-offset-1 col-sm-offset-1"><div class="alert alert-warning alert-dismissible text-center" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
           <h3>{{ListCtrl.analysisGroups.error.status}}: {{ListCtrl.analysisGroups.error.statusText}}</h3>
      </div></div>
    </div>
    <div class="form form-inline">
      <div class="checkbox checkbox-long" ng-repeat="ag in ListCtrl.analysisGroups.hits.hits">
        <label><input type="checkbox" ng-model="ListCtrl.filteredAGs[ag._source.title]" ng-change="ListCtrl.search({page: 1})"></input>{{ag._source.title}}</label>
      </div>
    </div>
  </div></div>

  <div class="panel panel-default" ng-if="ListCtrl.showDCPanel">
  <div class="panel-heading">Filter by data collection
  <button type="button" class="close" data-dismiss="alert" aria-label="Close" ng-click="ListCtrl.toggleDCPanel()"><span aria-hidden="true">&times;</span></button>
  </div>
  <div class="panel-body">
    <h4 class="text-center element-loading" ng-if="ListCtrl.dataCollections.isLoading"><span class="glyphicon glyphicon-hourglass" aria-hidden="true"></span> Loading...</h4>
    <div ng-if="ListCtrl.dataCollections.error">
       <div class="col-md-10 col-sm-10 col-md-offset-1 col-sm-offset-1"><div class="alert alert-warning alert-dismissible text-center" role="alert">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
             <h3>{{ListCtrl.dataCollections.error.status}}: {{ListCtrl.dataCollections.error.statusText}}</h3>
      </div></div>
    </div>
    <div class="form form-inline">
      <div class="checkbox checkbox-long" ng-repeat="dc in ListCtrl.dataCollections.hits.hits">
        <label><input type="checkbox" ng-model="ListCtrl.filteredDCs[dc._source.title]" ng-change="ListCtrl.search({page: 1})"></input>{{dc._source.title}}</label>
      </div>
    </div>
  </div></div>

  </div>

  <div class="col-md-10 col-md-offset-1" ng-if="ListCtrl.filteredPopsArray.length || ListCtrl.filteredDCsArray.length || ListCtrl.filteredAGsArray.length"><div class="form form-inline form-margins">
    <div class="form-group"><h3>Filters:</h3></div>
    <button type="button" ng-repeat="popCode in ListCtrl.filteredPopsArray" class="btn btn-primary" ng-click="ListCtrl.filteredPops[popCode] = false; ListCtrl.search();">{{popCode}} <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
    <button type="button" ng-repeat="dc in ListCtrl.filteredDCsArray" class="btn btn-warning" ng-click="ListCtrl.filteredDCs[dc.title] = false; ListCtrl.search();">{{dc.shortTitle}} <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
    <button type="button" ng-repeat="ag in ListCtrl.filteredAGsArray" class="btn btn-info" ng-click="ListCtrl.filteredAGs[ag.title] = false; ListCtrl.search();">{{ag.shortTitle}} <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>
  </div></div>

  <div class="clearfix"></div>
  <div class="matrix-wrapper">
  <div class="matrix-gap-filler pager-narrow-margins">
  <h4 ng-if="samples.total">Showing {{(ListCtrl.page-1)*ListCtrl.hitsPerPage +1}} to {{(ListCtrl.page-1)*ListCtrl.hitsPerPage + samples.hits.length}} of {{samples.total}} samples</h4>
  <h4 ng-if="!samples.total">No samples match all filters</h4>
  <div class="pager-left-align"><uib-pager ng-if="samples.total > ListCtrl.hitsPerPage"
            items-per-page="ListCtrl.hitsPerPage" ng-model="ListCtrl.page"
           ng-change="ListCtrl.search()" total-items="samples.total" align="false"></uib-pager></div>
  </div>

  <table class="table table-striped table-condensed matrix" ng-show="!esSamplesLoading">
  <thead><tr>
    <th>Sample</th>
    <th>Sex</th>
    <th>Population</th>
    <th ng-if="ListCtrl.viewOption == 1" ng-repeat="dc in ListCtrl.dataCollections.hits.hits" class="matrix-dot"><div>
      <div ng-click="ListCtrl.filteredDCs[dc._source.title] = !ListCtrl.filteredDCs[dc._source.title]; ListCtrl.search({page:1});">
      <div>{{dc._source.shortTitle}}</div></div></div></th>
    <th ng-if="ListCtrl.viewOption == 2" ng-repeat="ag in ListCtrl.analysisGroups.hits.hits" class="matrix-dot matrix-dot-narrow"><div>
      <div ng-click="ListCtrl.filteredAGs[ag._source.title] = !ListCtrl.filteredAGs[ag._source.title]; ListCtrl.search({page:1});">
      <div>{{ag._source.shortTitle}}</div></div></div></th>
  </tr></thead>
  <tr ng-repeat="sample in samples.hits">
    <td><a ng-href="sample/{{sample.fields.name[0]}}">{{sample.fields.name[0]}}</a></td>
    <td>{{sample.fields.sex[0] | ucFirst}}</td>
    <td><a ng-href="population/{{sample.fields['population.code'][0]}}" uib-popover="{{sample.fields['population.name'][0]}}" popover-trigger="mouseenter">{{sample.fields['population.code'][0]}}</a></td>
    <td ng-if="ListCtrl.viewOption == 1" ng-repeat="dc in ListCtrl.dataCollections.hits.hits" class="matrix-dot">
        <div class="matrix-dot-item matrix-dot-item-gold" ng-if="ListCtrl.hasCollection(sample, dc._source.title)" uib-popover="{{dc._source.title}}" popover-title="{{sample.fields.name[0]}}" popover-trigger="mouseenter">&#x25cf;</div>
    </td>
    <td ng-if="ListCtrl.viewOption == 2" ng-repeat="ag in ListCtrl.analysisGroups.hits.hits" class="matrix-dot matrix-dot-narrow">
        <div class="matrix-dot-item matrix-dot-item-blue" ng-if="ListCtrl.hasAnalysisGroup(sample, ag._source.title)" uib-popover="{{ag._source.title}}" popover-title="{{sample.fields.name[0]}}" popover-trigger="mouseenter">&#x25cf;</div>
    </td>
  </tr>
  </table>
  </div>
  <uib-pager ng-if="samples.total > ListCtrl.hitsPerPage"
            items-per-page="ListCtrl.hitsPerPage" ng-model="ListCtrl.page"
           ng-change="ListCtrl.search()" total-items="samples.total" align="true"></uib-pager>

  </div>
</div>
